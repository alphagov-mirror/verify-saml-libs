language: java
env:
  global:
    - VERIFY_USE_PUBLIC_BINARIES=true
    # CODACY_PROJECT_TOKEN
    - secure: "oxKr68jSBUMtqG9djhRpkt1Wek7WNqbs5EwUXcxLAx4izMbQR2MpXS7wj7IF4FXCq2ZyHIuPookzi4aqZyA9LEcEKYIotr8fq2QZ27EXrNsAXNwWJNnYO1GfP7PuDwcNKaFrubxCshA6Yga8nOV/11A1hq8ngiQ6YRMSEvU64NXqvEgp4jVIDRAW6ZHtEWn9BiNiLm1Bf/5wQ7+VLWIzSPEjdQc1qIwlpcr1c+IzmWkcAoOSRlZQlB1CM5ZAo3OY+9lACr2vhL07AufkwiiCQ0uMBv/zcvG0iexp8U9IA1EMNgvW+zsEyVYyVf3AvQWsAOV+RQn2Pia3tfHdi9miWIzIjvwVnVCK3eWkBnGoWm/k7V30aeV8yRsMwTzaSgFMLXk2C6LJfIGbH7RZE96K/SkJ4wYMJe0PbZwoYaE6wX44AVrDZpSFPeop7rdbfRBBmzHTs0npRvN7bPp+PGbQ3jOK/PMmkrlm7z7OX55DHglZfoywyQj3+3k42bbjXe75eIPr6KQ+DA0pTGUfSoJRnjhIck9tGQ32EFGewwn+eDkv/iRchyzvZF2vmJe0TAtRCQR5LSGj/TlvFdvPHMGg+3n5qzbHMpIS1WN/SEKp++6oxMZbgvt/of8Tvlv3OQb43gFtDFbvp6Jyz6WAH4fm24oehw+4Cq95TEsqBSJPCa8="
    # GITHUB_PAT
    - secure: "imuYgcceehUVjF5tQ2SXtQXc7VqhvTT2yTaEyx3wE/V+tKGkk4Y7h/dI8Jie5L507ogrKWzZFz95DCn6teEdymHSd+ZTMoDN7izBs17eJ3YU2P5VNyTjjlF1cpZZepe94mRTYj4/MyclQM87FzFaBd1662KJY1WhO3rC0/PrMAVoqGnsVZed50VXemztl/fkdroPGzwRH6eMV2CZ1QWHyWNyQbdnqc6lpgdC1SYTiHX2CmUrud95zCRJyTKV52XDckINvNbIqUW7fkxpKt9gZiSgVeW1jmYb8RI0SvOp0DjFtesZzYFkAB36hB582qjsdG7a8qzM/Zc0f5hpUf2mpOZI2LH84XiDTIstigvSX0UZVt5DmzBzJMMKPfr+hy8glVvihPWdr/JDm72TjnTqJFLTTXGSWW8vvlIVEdjwwnZOFP11GU6WMzGswJEW5IqtuPeclL16CHdjhF6oQDL0DFGlYTDtlXMApwHmS0tKc1d6qENSy4FihapIXWehv2WwVCvyu/OxPMC4nUHnZZlsRsmcAeevfwegyyxDVwQhLzs9mVm11vSDlLfM2QzbRpUthLqfmsbLvhvdx0d2dzxuDgblwpujBGzJI2khvo/a34s79WDbIN2rZ9deFuiR0i6DOusJU2Iivp30AYXVqD1KyIxrH2JyVtWDaV6LwXXXQ2s="

jdk:
  - openjdk11
  - openjdk8
  - oraclejdk8
matrix:
before_install:
  - sudo apt-get install jq
  - curl -u ida-codacy-bot:$GITHUB_PAT -LSs $(curl -u ida-codacy-bot:$GITHUB_PAT -LSs https://api.github.com/repos/codacy/codacy-coverage-reporter/releases/latest | jq -r '.assets | map({content_type, browser_download_url} | select(.content_type | contains("java-archive"))) | .[0].browser_download_url') -o codacy-coverage-reporter-assembly.jar
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
after_success:
  - "./gradlew jacocoRootReport"
  - java -jar codacy-coverage-reporter-assembly.jar report -l Java -r build/reports/jacoco/jacocoRootReport/jacocoRootReport.xml
